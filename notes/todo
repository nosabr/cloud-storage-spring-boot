## Исправленный алгоритм
```
1. Аплоад (весь метод в @Transactional)
   
   A. Предварительная валидация ВСЕХ файлов:
      - для каждого MultipartFile:
        - нормализуем путь мб не делать?
        - валидируем путь мб тож не делать?
        - парсим сегменты
   
   B. Проверка конфликтов ВСЕХ файлов:
      - для каждого файла:
        - проверяем существование по name + parentId
        - если существует → throw 409 (откат всей операции)
   
   C. Создание структуры в БД:
      - для каждого файла:
        - создаем промежуточные папки (segments[0..n-2])
          - переиспользуем существующие папки
          - БЕЗ storageKey для папок
        - последний сегмент (segments[n-1]) = файл
        - генерируем UUID для файла
        - создаем FileNode с storageKey, size, type=FILE
        - сохраняем в БД
   
   D. Загрузка в MinIO:
      - для каждого файла:
        - uploadObject(storageKey, inputStream, size)
      - если MinIO упал → автоматический откат транзакции БД
   
   E. Формирование response:
      - возвращаем FileUploadResponse только для файлов (последние сегменты)